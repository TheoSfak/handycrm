    
    /**
     * Show reset password form
     */
    public function resetPassword() {
        $token = $_GET['token'] ?? '';
        
        if (empty($token)) {
            $this->flash('error', 'Μη έγκυρος σύνδεσμος επαναφοράς');
            $this->redirect('/login');
        }
        
        // Verify token
        $db = Database::getInstance()->getConnection();
        $stmt = $db->prepare("SELECT id FROM users WHERE reset_token = ? AND reset_token_expiry > NOW()");
        $stmt->execute([$token]);
        
        if (!$stmt->fetch()) {
            $this->flash('error', 'Ο σύνδεσμος επαναφοράς έχει λήξει ή δεν είναι έγκυρος');
            $this->redirect('/login');
        }
        
        $data = [
            'title' => 'Επαναφορά Κωδικού - ' . APP_NAME
        ];
        
        $this->view('auth/reset-password', $data);
    }
    
    /**
     * Process reset password
     */
    public function processResetPassword() {
        if ($_SERVER['REQUEST_METHOD'] !== 'POST') {
            $this->redirect('/login');
        }
        
        try {
            $token = $_POST['token'] ?? '';
            $password = $_POST['password'] ?? '';
            $passwordConfirm = $_POST['password_confirm'] ?? '';
            
            // Validate inputs
            if (empty($token) || empty($password) || empty($passwordConfirm)) {
                $this->flash('error', 'Παρακαλώ συμπληρώστε όλα τα πεδία');
                $this->redirect('/reset-password?token=' . urlencode($token));
            }
            
            if ($password !== $passwordConfirm) {
                $this->flash('error', 'Οι κωδικοί δεν ταιριάζουν');
                $this->redirect('/reset-password?token=' . urlencode($token));
            }
            
            if (strlen($password) < 6) {
                $this->flash('error', 'Ο κωδικός πρέπει να έχει τουλάχιστον 6 χαρακτήρες');
                $this->redirect('/reset-password?token=' . urlencode($token));
            }
            
            // Verify token
            $db = Database::getInstance()->getConnection();
            $stmt = $db->prepare("SELECT id FROM users WHERE reset_token = ? AND reset_token_expiry > NOW()");
            $stmt->execute([$token]);
            $user = $stmt->fetch(PDO::FETCH_ASSOC);
            
            if (!$user) {
                $this->flash('error', 'Ο σύνδεσμος επαναφοράς έχει λήξει ή δεν είναι έγκυρος');
                $this->redirect('/login');
            }
            
            // Update password and clear reset token
            $hashedPassword = password_hash($password, PASSWORD_DEFAULT);
            $updateStmt = $db->prepare("UPDATE users SET password = ?, reset_token = NULL, reset_token_expiry = NULL WHERE id = ?");
            $updateStmt->execute([$hashedPassword, $user['id']]);
            
            $this->flash('success', 'Ο κωδικός σας ενημερώθηκε επιτυχώς! Μπορείτε τώρα να συνδεθείτε.');
            $this->redirect('/login');
            
        } catch (Exception $e) {
            error_log("Reset password error: " . $e->getMessage());
            $this->flash('error', 'Παρουσιάστηκε σφάλμα. Παρακαλώ δοκιμάστε ξανά.');
            $this->redirect('/login');
        }
    }
}
