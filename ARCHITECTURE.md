# 🏗️ Δομή Συστήματος Εργασιών - HandyCRM

## 📊 Ιεραρχία Δεδομένων

```
ΠΕΛΑΤΗΣ (Customer)
    └─── ΕΡΓΟ (Project)
            ├─── Ραντεβού (Appointments)
            ├─── Σημειώσεις (Notes)
            └─── 📋 ΕΡΓΑΣΙΕΣ (Tasks) ⭐ ΝΕΟ!
                    ├─── 📦 ΥΛΙΚΑ (Materials)
                    │       ├─── Περιγραφή
                    │       ├─── Τιμή Μονάδας (€)
                    │       ├─── Ποσότητα
                    │       ├─── Μονάδα (μέτρα, κιλά, τεμάχια...)
                    │       └─── Σύνολο (αυτόματος υπολογισμός)
                    │
                    └─── 👷 ΕΡΓΑΤΙΚΑ (Labor)
                            ├─── Τεχνικός (από λίστα)
                            ├─── Ώρες Εργασίας
                            ├─── Χρόνος (από-έως)
                            ├─── Τιμή/Ώρα (€)
                            └─── Σύνολο (αυτόματος υπολογισμός)
```

---

## 🗂️ Πού Βρίσκονται στο Interface

### 1️⃣ **Είσοδος στο Έργο**
```
Πίνακας Ελέγχου → Έργα → [Επιλογή Έργου]
```

### 2️⃣ **Tabs στο Έργο**
```
┌─────────────────────────────────────────────────────────────┐
│  [Γενικά Στοιχεία]  [Εργασίες ⭐]  [Ραντεβού]             │
└─────────────────────────────────────────────────────────────┘
```

### 3️⃣ **Tab: Εργασίες** 
```
┌─────────────────────────────────────────────────────────────┐
│  📊 Summary Cards:                                          │
│  ┌──────────┐ ┌──────────┐ ┌──────────┐ ┌──────────┐      │
│  │ Σύνολο   │ │ Υλικά    │ │ Εργατικά │ │ Κόστος   │      │
│  │ Εργασιών │ │ 1,500€   │ │ 800€     │ │ 2,300€   │      │
│  └──────────┘ └──────────┘ └──────────┘ └──────────┘      │
│                                                             │
│  [Νέα Εργασία +]                                           │
│                                                             │
│  🔍 Φίλτρα:                                                │
│  Τύπος: [Όλες ▼]  Από: [____]  Έως: [____]  [Εφαρμογή]   │
│                                                             │
│  📋 Λίστα Εργασιών:                                        │
│  ┌───────────────────────────────────────────────────────┐ │
│  │ 15/10/2025 │ Μονοήμερη │ Τοποθέτηση ...│ 350€ │ 🔍📝🗑│ │
│  │ 16-18/10   │ 3 ημέρες  │ Επισκευή ...  │ 890€ │ 🔍📝🗑│ │
│  └───────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 4️⃣ **Δημιουργία/Επεξεργασία Εργασίας**
```
┌─────────────────────────────────────────────────────────────┐
│  ΒΑΣΙΚΕΣ ΠΛΗΡΟΦΟΡΙΕΣ:                                      │
│  • Τύπος: ◉ Μονοήμερη  ○ Εύρος Ημερομηνιών               │
│  • Ημερομηνία: [15/10/2025]                               │
│  • Περιγραφή: [Τοποθέτηση συστήματος ...]                │
│                                                             │
│  📦 ΥΛΙΚΑ:                                      [+ Υλικό]  │
│  ┌───────────────────────────────────────────────────────┐ │
│  │ Τσιμέντο  │ 10.50€ │ 20kg │ Κιλά │ = 210.00€  [🗑]   │ │
│  │ Σίδερο    │ 2.50€  │ 15τμχ│ Τεμχ │ = 37.50€   [🗑]   │ │
│  └───────────────────────────────────────────────────────┘ │
│                                      Σύνολο: 247.50€       │
│                                                             │
│  👷 ΕΡΓΑΤΙΚΑ:                                 [+ Τεχνικός]│
│  ┌───────────────────────────────────────────────────────┐ │
│  │ Γιώργος(Τεχν) │ 8h │ 09:00-17:00 │ 20€ │= 160€ [🗑]  │ │
│  │ Κώστας(Βοηθ)  │ 8h │ 09:00-17:00 │ 12€ │= 96€  [🗑]  │ │
│  └───────────────────────────────────────────────────────┘ │
│                                      Σύνολο: 256.00€       │
│                                                             │
│  ┌─────────────────────────────────────────────┐          │
│  │           ΓΕΝΙΚΟ ΣΥΝΟΛΟ: 503.50€             │          │
│  │  Υλικά: 247.50€  |  Εργατικά: 256.00€       │          │
│  └─────────────────────────────────────────────┘          │
│                                                             │
│  [Ακύρωση]                      [Αποθήκευση Εργασίας]     │
└─────────────────────────────────────────────────────────────┘
```

### 5️⃣ **Προβολή Εργασίας** (Readonly)
```
┌─────────────────────────────────────────────────────────────┐
│  Τοποθέτηση συστήματος                                     │
│  15/10/2025                    [Ανάλυση][Επεξ][Αντιγρ]     │
│                                                             │
│  📦 ΥΛΙΚΑ:                                                 │
│  ┌───────────────────────────────────────────────────────┐ │
│  │ Περιγραφή │ Τιμή │ Ποσ. │ Μονάδα │ Σύνολο            │ │
│  │ Τσιμέντο  │10.50€│  20  │ Κιλά   │ 210.00€           │ │
│  │ Σίδερο    │ 2.50€│  15  │ Τεμάχ. │  37.50€           │ │
│  │                           Σύνολο: 247.50€             │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  👷 ΕΡΓΑΤΙΚΑ:                                              │
│  ┌───────────────────────────────────────────────────────┐ │
│  │ Τεχνικός      │ Ώρες │ Χρόνος      │ €/h │ Σύνολο    │ │
│  │ Γιώργος (Τεχν)│  8h  │ 09:00-17:00 │ 20€ │ 160.00€   │ │
│  │ Κώστας (Βοηθ) │  8h  │ 09:00-17:00 │ 12€ │  96.00€   │ │
│  │                                Σύνολο: 256.00€         │ │
│  └───────────────────────────────────────────────────────┘ │
│                                                             │
│  ┌─────────────────────────────────────────────┐          │
│  │  💰 ΣΥΝΟΛΙΚΟ ΚΟΣΤΟΣ                          │          │
│  │                                               │          │
│  │  Υλικά:     247.50€ ████████░░ 49%          │          │
│  │  Εργατικά:  256.00€ █████████░ 51%          │          │
│  │  ─────────────────────────────               │          │
│  │  ΣΥΝΟΛΟ:    503.50€                          │          │
│  └─────────────────────────────────────────────┘          │
└─────────────────────────────────────────────────────────────┘
```

---

## 🗄️ Δομή Βάσης Δεδομένων

### Πίνακες:
```sql
1. technicians
   ├── id
   ├── name
   ├── role (technician/assistant)
   ├── hourly_rate
   ├── phone
   ├── email
   └── is_active

2. project_tasks
   ├── id
   ├── project_id (FK → projects)
   ├── task_type (single_day/date_range)
   ├── task_date
   ├── date_from
   ├── date_to
   ├── description
   ├── materials_total (αυτόματος)
   ├── labor_total (αυτόματος)
   └── daily_total (αυτόματος)

3. task_materials ⭐
   ├── id
   ├── task_id (FK → project_tasks)
   ├── description
   ├── unit_price
   ├── quantity
   ├── unit_type (meters/pieces/kg/liters...)
   └── subtotal (αυτόματος)

4. task_labor ⭐
   ├── id
   ├── task_id (FK → project_tasks)
   ├── technician_id (FK → technicians, nullable)
   ├── hours_worked
   ├── time_from
   ├── time_to
   ├── hourly_rate
   └── subtotal (αυτόματος)
```

---

## 📁 Αρχεία που Δημιουργήθηκαν

### Models (4):
```
models/
  ├── Technician.php         # Διαχείριση τεχνικών
  ├── ProjectTask.php        # Κύρια εργασία
  ├── TaskMaterial.php ⭐    # Υλικά της εργασίας
  └── TaskLabor.php ⭐       # Εργατικά της εργασίας
```

### Controllers (2):
```
controllers/
  ├── TechniciansController.php      # CRUD τεχνικών
  └── ProjectTasksController.php     # CRUD εργασιών (με υλικά & εργατικά)
```

### Views (9):
```
views/
  ├── technicians/
  │   ├── index.php          # Λίστα τεχνικών
  │   ├── add.php
  │   ├── edit.php
  │   └── view.php
  │
  └── projects/
      ├── show.php           # ✏️ Τροποποιήθηκε (tabs)
      └── tasks/
          ├── index.php      # Λίστα εργασιών ⭐
          ├── add.php        # Φόρμα με Υλικά & Εργατικά ⭐
          ├── edit.php       # Επεξεργασία με Υλικά & Εργατικά ⭐
          ├── view.php       # Προβολή με Υλικά & Εργατικά ⭐
          └── breakdown.php  # Ανάλυση ανά ημέρα
```

### JavaScript (1):
```
public/js/
  └── project-tasks.js       # Live calculations για Υλικά & Εργατικά
```

---

## 🎯 Live Calculations (JavaScript)

### Υλικά:
```javascript
Τιμή Μονάδας × Ποσότητα = Σύνολο Υλικού
10.50€ × 20kg = 210.00€

Άθροισμα όλων = Σύνολο Υλικών
210€ + 37.50€ = 247.50€
```

### Εργατικά:
```javascript
Ώρες × Τιμή/Ώρα = Σύνολο Εργατικού
8h × 20€/h = 160.00€

ή

Χρόνος: 09:00 - 17:00 = 8 ώρες (αυτόματα)
8h × 20€/h = 160.00€

Άθροισμα όλων = Σύνολο Εργατικών
160€ + 96€ = 256.00€
```

### Γενικό Σύνολο:
```javascript
Σύνολο Υλικών + Σύνολο Εργατικών = ΓΕΝΙΚΟ ΣΥΝΟΛΟ
247.50€ + 256.00€ = 503.50€
```

---

## 🔄 Flow Δημιουργίας Εργασίας

```
1. Χρήστης → Έργο → Tab "Εργασίες"
                ↓
2. Κλικ "Νέα Εργασία"
                ↓
3. Φόρμα Εργασίας
   ├── Επιλογή τύπου (μονοήμερη/εύρος)
   ├── Ημερομηνίες
   ├── Περιγραφή
   │
   ├── [+ Υλικό]
   │   ├── Περιγραφή: "Τσιμέντο"
   │   ├── Τιμή: 10.50€
   │   ├── Ποσότητα: 20
   │   ├── Μονάδα: Κιλά
   │   └── ✅ Σύνολο: 210€ (live calc)
   │
   ├── [+ Τεχνικός]
   │   ├── Επιλογή: "Γιώργος (Τεχνικός - 20€/h)"
   │   ├── Ώρες: 8 (ή 09:00-17:00)
   │   └── ✅ Σύνολο: 160€ (live calc)
   │
   └── ✅ Γενικό Σύνολο: 503.50€ (live calc)
                ↓
4. [Αποθήκευση] → AJAX POST
                ↓
5. Database:
   ├── INSERT INTO project_tasks (...)
   ├── INSERT INTO task_materials (...) [×N]
   ├── INSERT INTO task_labor (...) [×N]
   └── UPDATE project_tasks SET materials_total, labor_total
                ↓
6. Redirect → Λίστα Εργασιών με νέα εργασία ✅
```

---

## 💡 Βασικά Χαρακτηριστικά

### ✅ Υλικά (Materials):
- ➕ Προσθήκη πολλαπλών υλικών
- 📊 Live υπολογισμός subtotal
- 📏 Διάφορες μονάδες (μέτρα, κιλά, τεμάχια, λίτρα, κουτιά)
- 🗑️ Διαγραφή γραμμών
- 💰 Αυτόματο άθροισμα

### ✅ Εργατικά (Labor):
- 👷 Επιλογή τεχνικού από λίστα
- 🔄 Αυτόματη φόρτωση τιμής/ώρα
- ⏱️ Υπολογισμός ωρών από χρόνο (09:00-17:00 = 8h)
- 🌙 Υποστήριξη νυχτερινών βαρδιών
- 📊 Live υπολογισμός subtotal
- 🗑️ Διαγραφή γραμμών
- 💰 Αυτόματο άθροισμα

### ✅ Εργασίες (Tasks):
- 📅 Μονοήμερες ΚΑΙ εύρος ημερομηνιών
- ⚠️ Overlap detection (προειδοποίηση συγκρούσεων)
- 📊 Daily breakdown (ανάλυση ανά ημέρα)
- 📋 Copy functionality
- 🔍 Φίλτρα & sorting
- 📈 Summary cards

---

**Σύνοψη**: Τα **Υλικά** και **Μεροκάματα** βρίσκονται **ΜΕΣΑ** σε κάθε **Εργασία**, η οποία ανήκει σε ένα **Έργο**! 🎯
