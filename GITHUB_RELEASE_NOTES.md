# ğŸ‰ HandyCRM v1.3.5 - Advanced Payment Management & Role-Based Access Control

Î‘Ï…Ï„Î® Î· Î­ÎºÎ´Î¿ÏƒÎ· Ï†Î­ÏÎ½ÎµÎ¹ ÏƒÎ·Î¼Î±Î½Ï„Î¹ÎºÎ­Ï‚ Î²ÎµÎ»Ï„Î¹ÏÏƒÎµÎ¹Ï‚ ÏƒÏ„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î± Î´Î¹Î±Ï‡ÎµÎ¯ÏÎ¹ÏƒÎ·Ï‚ Ï€Î»Î·ÏÏ‰Î¼ÏÎ½ Ï„ÎµÏ‡Î½Î¹ÎºÏÎ½ ÎºÎ±Î¹ Î­Î½Î± Ï€Î»Î®ÏÎµÏ‚ ÏƒÏÏƒÏ„Î·Î¼Î± ÏÏŒÎ»Ï‰Î½ ÎºÎ±Î¹ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ Ï‡ÏÎ·ÏƒÏ„ÏÎ½.

## ğŸ’° Advanced Payment Management System

### Summary Statistics Dashboard
- ğŸ“Š **Grand Totals Card** Î¼Îµ ÏƒÏ…Î½Î¿Î»Î¹ÎºÎ¬ ÎºÎ­ÏÎ´Î·, Ï€Î»Î·ÏÏ‰Î¼Î­Î½Î± ÎºÎ±Î¹ Î±Ï€Î»Î®ÏÏ‰Ï„Î± Ï€Î¿ÏƒÎ¬
- ğŸ“ˆ **Progress Bar** Ï€Î¿Ï… Î´ÎµÎ¯Ï‡Î½ÎµÎ¹ Ï„Î¿ Ï€Î¿ÏƒÎ¿ÏƒÏ„ÏŒ Î¿Î»Î¿ÎºÎ»Î®ÏÏ‰ÏƒÎ·Ï‚ Ï€Î»Î·ÏÏ‰Î¼ÏÎ½
- ğŸ¨ **Modern UI** Î¼Îµ gradient styling ÎºÎ±Î¹ real-time calculations

### Quick Date Presets
- âš¡ **4 ÎšÎ¿Ï…Î¼Ï€Î¹Î¬ Î“ÏÎ®Î³Î¿ÏÎ·Ï‚ Î•Ï€Î¹Î»Î¿Î³Î®Ï‚**:
  - Î¤ÏÎ­Ï‡Î¿Ï…ÏƒÎ± Î•Î²Î´Î¿Î¼Î¬Î´Î±
  - Î ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î· Î•Î²Î´Î¿Î¼Î¬Î´Î±
  - Î¤ÏÎ­Ï‡Ï‰Î½ ÎœÎ®Î½Î±Ï‚
  - Î ÏÎ¿Î·Î³Î¿ÏÎ¼ÎµÎ½Î¿Ï‚ ÎœÎ®Î½Î±Ï‚
- ğŸš€ Auto-fill Ï„Ï‰Î½ Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¹ÏÎ½ Î¼Îµ Î­Î½Î± ÎºÎ»Î¹Îº

### CSV Export
- ğŸ“¥ **Î•Î¾Î±Î³Ï‰Î³Î® ÏƒÎµ Excel/CSV** Î¼Îµ ÏŒÎ»Î± Ï„Î± Ï†Î¯Î»Ï„ÏÎ±
- ğŸ“‹ Î ÎµÏÎ¹Î»Î±Î¼Î²Î¬Î½ÎµÎ¹: Ï„ÎµÏ‡Î½Î¹ÎºÏŒ, Î·Î¼ÎµÏÎ¿Î¼Î·Î½Î¯Î±, Î­ÏÎ³Î¿, ÎµÏÎ³Î±ÏƒÎ¯Î±, ÏÏÎµÏ‚, Î±Î¼Î¿Î¹Î²Î®, Ï€Î¿ÏƒÏŒ, ÎºÎ±Ï„Î¬ÏƒÏ„Î±ÏƒÎ·
- ğŸ‡¬ğŸ‡· Î£Ï‰ÏƒÏ„Î® Ï…Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· ÎµÎ»Î»Î·Î½Î¹ÎºÏÎ½ Ï‡Î±ÏÎ±ÎºÏ„Î®ÏÏ‰Î½ (UTF-8 BOM)

### Bulk Payment Actions
- âœ… **"Î•Ï€Î¹ÏƒÎ®Î¼Î±Î½ÏƒÎ· ÎŒÎ»Ï‰Î½ Ï‰Ï‚ Î Î»Î·ÏÏ‰Î¼Î­Î½Î±"** Î¼Îµ Î­Î½Î± ÎºÎ»Î¹Îº
- ğŸ“ Confirmation modal Î¼Îµ Î»Î¯ÏƒÏ„Î± Ï„ÎµÏ‡Î½Î¹ÎºÏÎ½ ÎºÎ±Î¹ Ï€Î¿ÏƒÏÎ½
- ğŸ’ª Î¥Ï€Î¿ÏƒÏ„Î®ÏÎ¹Î¾Î· **ÏŒÎ»Ï‰Î½ Ï„Ï‰Î½ ÏÏŒÎ»Ï‰Î½** (Admin, Supervisor, Technician, Assistant)
- ğŸ¯ AJAX endpoint Î³Î¹Î± Î³ÏÎ®Î³Î¿ÏÎ· bulk ÎµÎ½Î·Î¼Î­ÏÏ‰ÏƒÎ·

### Visual Enhancements
- ğŸ“Š **Progress bars** ÏƒÎµ ÎºÎ¬Î¸Îµ ÎºÎ¬ÏÏ„Î± Ï„ÎµÏ‡Î½Î¹ÎºÎ¿Ï
- ğŸ¨ **Color-coded amounts**: Î ÏÎ¬ÏƒÎ¹Î½Î¿ Î³Î¹Î± Ï€Î»Î·ÏÏ‰Î¼Î­Î½Î±, ÎºÏŒÎºÎºÎ¹Î½Î¿ Î³Î¹Î± Î±Ï€Î»Î®ÏÏ‰Ï„Î±
- ğŸ’¬ **Enhanced tooltips** Î¼Îµ Î»ÎµÏ€Ï„Î¿Î¼ÎµÏÎµÎ¯Ï‚ Ï€Î»Î·ÏÎ¿Ï†Î¿ÏÎ¯ÎµÏ‚
- ğŸ·ï¸ **Role badges** Î´Î¯Ï€Î»Î± ÏƒÎµ ÎºÎ¬Î¸Îµ ÏŒÎ½Î¿Î¼Î± (Ï€.Ï‡. "Î¤Î•Î§ÎÎ™ÎšÎŸÎ£", "Î¥Î Î•Î¥Î˜Î¥ÎÎŸÎ£ Î£Î¥ÎÎ•Î¡Î“Î•Î™ÎŸÎ¥")
- ğŸŒˆ **Gradient headers** Î¼Îµ Î²ÎµÎ»Ï„Î¹Ï‰Î¼Î­Î½Î· Î¿Ï€Ï„Î¹ÎºÎ® Î¹ÎµÏÎ±ÏÏ‡Î¯Î±

## ğŸ‘¥ Role-Based Access Control System

### Four-Tier Role System
- ğŸ‘‘ **Admin (Î”Î¹Î±Ï‡ÎµÎ¹ÏÎ¹ÏƒÏ„Î®Ï‚)**: Î Î»Î®ÏÎ·Ï‚ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ· ÏƒÎµ ÏŒÎ»Î¿ Ï„Î¿ ÏƒÏÏƒÏ„Î·Î¼Î±
- ğŸ‘¨â€ğŸ’¼ **Supervisor (Î¥Ï€ÎµÏÎ¸Ï…Î½Î¿Ï‚ Î£Ï…Î½ÎµÏÎ³ÎµÎ¯Î¿Ï…)**: ÎˆÏÎ³Î±, Ï…Î»Î¹ÎºÎ¬, Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ® ÎºÎ±ÏÏ„Î­Î»Î±
- ğŸ”§ **Technician (Î¤ÎµÏ‡Î½Î¹ÎºÏŒÏ‚)**: ÎœÏŒÎ½Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ® ÎºÎ±ÏÏ„Î­Î»Î±
- ğŸ› ï¸ **Assistant (Î’Î¿Î·Î¸ÏŒÏ‚ Î¤ÎµÏ‡Î½Î¹ÎºÎ¿Ï)**: ÎœÏŒÎ½Î¿ Ï€ÏÎ¿ÏƒÏ‰Ï€Î¹ÎºÎ® ÎºÎ±ÏÏ„Î­Î»Î±

### Permission System
- ğŸ” **BaseController Permission Methods**: `canManageProjects()`, `canManageMaterials()`, `canViewUser()`
- ğŸšª **Guard Methods**: `requireAdmin()`, `requireSupervisorOrAdmin()` Î³Î¹Î± Î­Î»ÎµÎ³Ï‡Î¿ Ï€ÏÏŒÏƒÎ²Î±ÏƒÎ·Ï‚
- ğŸ“± **Dynamic Sidebar Menu**: Î¤Î¿ menu Ï€ÏÎ¿ÏƒÎ±ÏÎ¼ÏŒÎ¶ÎµÏ„Î±Î¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÏƒÏ„Î¿ ÏÏŒÎ»Î¿ Ï„Î¿Ï… Ï‡ÏÎ®ÏƒÏ„Î·
- âœ… **Permission Checks**: ÎˆÎ»ÎµÎ³Ï‡Î¿Î¹ Î´Î¹ÎºÎ±Î¹Ï‰Î¼Î¬Ï„Ï‰Î½ ÏƒÎµ controllers

### Database Updates
- ğŸ—„ï¸ **Automated Migration**: Î¤ÏÎ­Ï‡ÎµÎ¹ Î±Ï…Ï„ÏŒÎ¼Î±Ï„Î± ÎºÎ±Ï„Î¬ Ï„Î¿ login
- ğŸ“ **Idempotent**: Î‘ÏƒÏ†Î±Î»Î­Ï‚ Î½Î± Ï„ÏÎ­Î¾ÎµÎ¹ Ï€Î¿Î»Î»Î­Ï‚ Ï†Î¿ÏÎ­Ï‚
- ğŸ”„ **Rollback Safe**: Transaction-based migration

## ğŸ› Critical Bug Fixes

### PHP Foreach Reference Bug
- âŒ **Î ÏÏŒÎ²Î»Î·Î¼Î±**: Duplicate technician cards (Ï€.Ï‡. "Î£Ï†Î±ÎºÎ¹Î±Î½Î¬ÎºÎ·Ï‚" ÎµÎ¼Ï†Î±Î½Î¹Î¶ÏŒÏ„Î±Î½ Î´ÏÎ¿ Ï†Î¿ÏÎ­Ï‚)
- âœ… **Î›ÏÏƒÎ·**: Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ `unset($tech)` Î¼ÎµÏ„Î¬ Ï„Î¿ foreach loop
- ğŸ¯ **Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±**: ÎšÎ¬Î¸Îµ Ï„ÎµÏ‡Î½Î¹ÎºÏŒÏ‚ ÎµÎ¼Ï†Î±Î½Î¯Î¶ÎµÏ„Î±Î¹ Î¼Î¯Î± Ï†Î¿ÏÎ¬

### Payment Query Role Restriction
- âŒ **Î ÏÏŒÎ²Î»Î·Î¼Î±**: Supervisors Î´ÎµÎ½ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î½ ÏƒÏ„Î· Î»Î¯ÏƒÏ„Î± Ï€Î»Î·ÏÏ‰Î¼ÏÎ½
- âœ… **Î›ÏÏƒÎ·**: Î‘Ï†Î±Î¹ÏÎ­Î¸Î·ÎºÎµ Ï„Î¿ role restriction Î±Ï€ÏŒ Payment model
- ğŸ¯ **Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±**: ÎŒÎ»Î¿Î¹ Î¿Î¹ ÏÏŒÎ»Î¿Î¹ ÎµÎ¼Ï†Î±Î½Î¯Î¶Î¿Î½Ï„Î±Î¹ Ï€Î»Î­Î¿Î½

### Bulk Payment Amount Detection
- âŒ **Î ÏÏŒÎ²Î»Î·Î¼Î±**: Î›Î¬Î¸Î¿Ï‚ Ï€Î¿ÏƒÎ¬ ÏƒÏ„Î¿ modal (Ï€.Ï‡. 15000.00â‚¬ Î±Î½Ï„Î¯ Î³Î¹Î± 150.00â‚¬)
- âœ… **Î›ÏÏƒÎ·**: Î ÏÎ¿ÏƒÏ„Î­Î¸Î·ÎºÎµ `data-unpaid-amount` attribute
- ğŸ¯ **Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±**: Î£Ï‰ÏƒÏ„Î® ÎµÎ¼Ï†Î¬Î½Î¹ÏƒÎ· Ï€Î¿ÏƒÏÎ½

### UI Improvements
- âŒ **Î ÏÏŒÎ²Î»Î·Î¼Î±**: ÎœÏ€Î»Îµ ÎºÎµÎ¯Î¼ÎµÎ½Î¿ ÏƒÎµ Î¼Ï‰Î² gradient (Î´ÏÏƒÎºÎ¿Î»Î¿ ÏƒÏ„Î·Î½ Î±Î½Î¬Î³Î½Ï‰ÏƒÎ·)
- âœ… **Î›ÏÏƒÎ·**: Î‘Î»Î»Î±Î³Î® ÏƒÎµ Î»ÎµÏ…ÎºÏŒ ÎºÎµÎ¯Î¼ÎµÎ½Î¿
- ğŸ¯ **Î‘Ï€Î¿Ï„Î­Î»ÎµÏƒÎ¼Î±**: ÎšÎ±Î»ÏÏ„ÎµÏÎ· Î±Î½Î±Î³Î½Ï‰ÏƒÎ¹Î¼ÏŒÏ„Î·Ï„Î±

## ğŸ“¦ Installation & Upgrade

### Fresh Installation
```bash
# Download and extract
unzip handycrm-v1.3.5.zip -d /var/www/html/handycrm

# Import database
mysql -u username -p handycrm < database/schema.sql

# Configure
cp config/config.php.example config/config.php
# Edit config.php with your settings

# Set permissions
chmod 755 uploads logs

# Access via browser
http://localhost/handycrm
```

**Default Login**: 
- Username: `admin`
- Password: `admin123`
- âš ï¸ Change immediately after first login!

### Upgrade from v1.3.0+
```bash
# Backup first!
mysqldump -u username -p handycrm > backup.sql

# Update files
git pull origin main
git checkout v1.3.5

# Login to trigger automatic migration
# Or run manually:
mysql -u username -p handycrm < migrations/migrate_to_1.3.5.sql
```

### Migration Details
The migration adds:
- `supervisor` role to users.role ENUM
- `paid_at` column to task_labor (if missing)
- `paid_by` column to task_labor (if missing)
- `is_active` column to users (if missing)
- Performance indexes for payment queries

**Migration is IDEMPOTENT**: Safe to run multiple times!

## ğŸ“ Files Changed

### New Files
- `migrations/migrate_to_1.3.5.sql` - Main migration
- `migrations/verify_1.3.5_ready.sql` - Verification script
- `INSTALL.md` - Installation guide
- `DEPLOYMENT_CHECKLIST.md` - Release checklist

### Modified Files
- `controllers/PaymentsController.php` - Bulk payment, bug fixes
- `models/Payment.php` - Role inclusion, query optimization
- `classes/BaseController.php` - Permission methods
- `views/includes/header.php` - Role-based menu
- `views/payments/index.php` - All payment enhancements
- `views/users/edit.php` & `create.php` - Supervisor role
- `README.md` - v1.3.5 documentation
- `CHANGELOG.md` - Complete changelog
- `VERSION` - Updated to 1.3.5

## ğŸ” What's Next?

Check out the [full changelog](CHANGELOG.md) for detailed technical information.

For installation help, see [INSTALL.md](INSTALL.md).

## ğŸ™ Acknowledgments

Thank you to all users who provided feedback and bug reports!

## ğŸ“ Support

- ğŸ“– [Documentation](README.md)
- ğŸ› [Report Issues](https://github.com/TheoSfak/handycrm/issues)
- ğŸ“§ Email: theodore.sfakianakis@gmail.com

---

**Full Changelog**: [v1.3.0...v1.3.5](https://github.com/TheoSfak/handycrm/compare/v1.3.0...v1.3.5)

**Release Date**: October 21, 2025  
**Build Status**: âœ… Stable  
**Download**: handycrm-v1.3.5.zip (0.39 MB)
